<!DOCTYPE html>
<html lang="<?= localeToBCP47($current_locale) ?>">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="initial-scale=1.0" />
        <?php if($canonical): ?>
            <link rel="canonical" href="<?= $canonical ?>">
        <?php elseif($current_action_pointer): ?>
            <link rel="canonical" href="<?= url_full($current_action_pointer) ?>">
        <?php endif; ?>
        <link rel="shortcut icon" href="<?= url_static('favicon-32px.png') ?>">

        <link rel="stylesheet" href="<?= url_asset('stylesheets/application.css') ?>" data-turbolinks-track="reload">
        <?php foreach ($styles as $style_name): ?>
            <link rel="stylesheet" href="<?= url_asset("stylesheets/{$style_name}.css") ?>" data-turbolinks-track="reload">
        <?php endforeach; ?>

        <script id="javascript-configuration" type="application/json">
            <?= $this->safe('javascript_configuration') ?>
        </script>
        <script src="<?= url_asset('javascripts/application.js') ?>" data-turbolinks-track="reload" defer></script>

        <title><?php if ($environment === 'development'): ?>[devmode] <?php endif; ?><?= $title ?> · <?= $brand ?></title>
    </head>

    <body>
        <a
            class="no-mobile accessibility-nav anchor--action"
            href="#main-content"
            tabindex="0"
            data-turbolinks="false"
            data-controller="skip-nav"
            data-action="skip-nav#skip"
        >
            <?= _('Skip to main content') ?>
        </a>

        <div class="layout">
            <noscript>
                <div class="layout__banner layout__banner--alert">
                    <div class="banner__container">
                        <?= _f('You need to activate JavaScript in order to use %s.', $brand) ?>
                    </div>
                </div>
            </noscript>

            <?php if ($demo): ?>
                <div class="layout__banner">
                    <div class="banner__container">
                        <?= _f('You’re using a demo version of %s, the data are reset every night.', $brand) ?>
                    </div>
                </div>
            <?php endif; ?>

            <header class="layout__header layout__header--not-connected header">
                <nav class="header__container">
                    <a class="header__link header__link--home" href="<?= url('home') ?>">
                        <img
                            alt="flus"
                            src="<?= url_static('logo.svg') ?>"
                            width="120"
                            height="40.6"
                        />
                    </a>

                    <div class="header__separator"></div>

                    <?php if ($registrations_opened): ?>
                        <a class="header__link no-mobile" href="<?= url('registration') ?>">
                            <?= _('Sign up') ?>
                        </a>
                    <?php endif; ?>

                    <form
                        class="header__locale-form"
                        method="post"
                        action="<?= url('change locale') ?>"
                        data-controller="form-autosubmit"
                    >
                        <input type="hidden" name="csrf" value="<?= csrf_token() ?>" />
                        <?php if(isset($canonical)): ?>
                            <input type="hidden" name="redirect_to" value="<?= $canonical ?>" />
                        <?php elseif($current_action_pointer): ?>
                            <input type="hidden" name="redirect_to" value="<?= url($current_action_pointer) ?>" />
                        <?php endif; ?>

                        <div class="form-group">
                            <label for="locale" class="icon icon--language" aria-label="<?= _('Choose your language') ?>">
                                <select
                                    id="locale"
                                    name="locale"
                                    data-action="form-autosubmit#submit"
                                >
                                    <?php foreach ($available_locales as $locale_value => $locale_name): ?>
                                        <option
                                            value="<?= $locale_value ?>"
                                            <?= $locale_value === $current_locale ? 'selected' : '' ?>
                                        >
                                            <?= $locale_name ?>
                                        </option>
                                    <?php endforeach; ?>
                                </select>
                            </label>
                        </div>
                    </form>
                </nav>
            </header>

            <main id="main-content" class="layout__content" tabindex="-1">
                <?= $this->safe('content') ?>
            </main>

            <footer class="layout__footer">
                <p>
                    <a href="https://flus.fr">
                        <?= _f('About %s', $brand) ?>
                    </a>
                </p>
            </footer>
        </div>
    </body>
</html>
