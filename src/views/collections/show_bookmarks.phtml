<?php
    $this->layout('base.phtml', [
        'title' => _('Bookmarks'),
        'current_tab' => 'bookmarks',
    ]);
?>

<div class="section" data-controller="back-storage" data-back-storage-type="link">
    <div class="section__title">
        <h1><?= $this->protect($collection->name()) ?></h1>
    </div>

    <p class="section__intro">
        <?= _('Place here the links you want to consult later on.') ?>
    </p>

    <div class="cards">
        <div class="card card--action">
            <button
                class="card__button card__button--link"
                data-controller="modal-opener"
                data-action="modal-opener#fetch"
                data-modal-opener-href="<?= url('new link', ['collection' => $collection->id]) ?>"
                aria-haspopup="dialog"
                aria-controls="modal"
            >
                <i class="icon icon--only icon--plus-circle"></i><br />
                <?= _('Add a link') ?>
            </button>
        </div>

        <?php foreach ($links as $link): ?>
            <div class="card" data-controller="link-card">
                <a
                    class="anchor--hidden"
                    target="_blank"
                    rel="noopener noreferrer"
                    tabindex="-1"
                    href="<?= $link->url ?>"
                >
                    <?php if ($link->image_filename): ?>
                        <img class="card__image" alt="" src="<?= url_link_image('cards', $link->image_filename) ?>" />
                    <?php else: ?>
                        <img class="card__image" alt="" src="<?= url_static('default-card.png') ?>" />
                    <?php endif; ?>
                </a>

                <div class="card__body">
                    <h2 class="card__title">
                        <a
                            class="anchor--hidden"
                            target="_blank"
                            rel="noopener noreferrer"
                            tabindex="-1"
                            href="<?= $link->url ?>"
                        >
                            <?= $this->protect($link->title) ?>
                        </a>
                    </h2>

                    <p class="card__details">
                        <span class="card__ellipsis"><?= $this->protect($link->host()) ?></span>&nbsp;Â·&nbsp;<?= format_reading_time($link->reading_time) ?>
                    </p>

                    <p class="card__details">
                        <a class="icon icon--inline icon--ghost icon--anchor icon--comments" href="<?= url('link', ['id' => $link->id]) ?>">
                            <?= _nf('%d comment', '%d comments', $link->number_comments, $link->number_comments) ?>
                        </a>
                    </p>
                </div>

                <div class="card__footer">
                    <form
                        method="post"
                        action="<?= url('unbookmark link', ['id' => $link->id]) ?>"
                        data-action="link-card#unbookmark"
                    >
                        <input type="hidden" name="csrf" value="<?= csrf_token() ?>" />

                        <button
                            class="button--ghost button--smaller"
                            title="<?= _('Remove from bookmarks') ?>"
                            aria-label="<?= _('Remove from bookmarks') ?>"
                        >
                            <i class="icon icon--only icon--ghost icon--times"></i>
                        </button>
                    </form>

                    <a
                        class="anchor--action icon icon--anchor icon--pop-out"
                        target="_blank"
                        rel="noopener noreferrer"
                        href="<?= $link->url ?>"
                    >
                        <?= _('read') ?>
                    </a>
                </div>

                <div class="card__mask" data-target="link-card.mask">
                    <form
                        method="post"
                        action="<?= url('bookmark link', ['id' => $link->id]) ?>"
                        data-action="link-card#bookmark"
                    >
                        <input type="hidden" name="csrf" value="<?= csrf_token() ?>" />

                        <button class="button--ghost button--small">
                            <?= _('Cancel?') ?>
                        </button>
                    </form>
                </div>
            </div>
        <?php endforeach; ?>

        <?php for ($i = 0; $i < (3 - ((count($links) + 1) % 3)); $i++): ?>
            <div class="card card--shadow no-mobile"></div>
        <?php endfor; ?>
    </div>

    <img
        class="illustration illustration--centered"
        alt=""
        src="<?= url_static('illustrations/save_to_bookmarks.svg') ?>"
        height="250"
    />
</div>
